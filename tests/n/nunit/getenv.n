# Copyright 2015 the Neutrino authors (see AUTHORS).
# Licensed under the Apache License, Version 2.0 (see LICENSE).

import $assert;
import $core;

def $try_getenv($index, $vars) {
  $assert:not($index == ($vars.length));
  def $name := $vars[$index];
  def $p_value := @core:ctrino.get_environment_variable($name);
  $assert:not($p_value.is_resolved?);
  $p_value.then(fn $value {
    if $value.is_null?
      then $try_getenv($index + 1, $vars);
  });
}

def $test_expected() {
  # One of these should be set.
  def $vars := [
    "HOME", # most unices
    "USERNAME", # most windoces
    "WORKSPACE" # jenkins
  ];
  $try_getenv(0, $vars);
}

do {
  $test_expected();
}
