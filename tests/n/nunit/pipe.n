# Copyright 2015 the Neutrino authors (see AUTHORS).
# Licensed under the Apache License, Version 2.0 (see LICENSE).

import $assert;
import $core;

def $test_simple() {
  def $pipe := new @core:io:Pipe();
  def $p_write := $pipe.out.write("Hello, World!");
  $assert:not($p_write.is_resolved?);
  $p_write.then(fn $v {
    $assert:that($v);
  });
  def $p_read_1 := $pipe.in.read(5);
  $assert:not($p_read_1.is_resolved?);
  $p_read_1.then(fn $v {
    $assert:equals("Hello", $v);
  });
  def $p_read_2 := $pipe.in.read(2);
  $assert:not($p_read_2.is_resolved?);
  $p_read_2.then(fn $v {
    $assert:equals(", ", $v);
  });
  def $p_read_3 := $pipe.in.read(6);
  $assert:not($p_read_3.is_resolved?);
  $p_read_3.then(fn $v {
    $assert:equals("World!", $v);
  });  
}

do {
  $test_simple();
}
